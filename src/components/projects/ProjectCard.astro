---
import AnimatedButton from '@/components/base/AnimatedButton.astro'
import BannerImage from '@/components/base/BannerImage.astro'
import { ICON_MAP, SITE } from '@/config'
import { Icon } from 'astro-icon/components'
import type { CollectionEntry } from 'astro:content'

interface Props {
  entry: CollectionEntry<'projects'>
}

const { entry } = Astro.props

// 卡片尺寸配置 - 可自定义修改
const CARD_CONFIG = {
  // 卡片圆角
  rounded: 'rounded-lg',
  // 图片区域宽度（所有屏幕尺寸统一显示在左侧）
  imageWidth: 'max-w-[100px] sm:max-w-[140px]', // 移动端 100px，桌面端 140px
  // 内容区域内边距
  contentPadding: 'p-3',
  // 内容间距
  contentGap: 'gap-3',
  // 标题字体大小
  titleSize: 'text-lg',
  // 描述字体大小
  descriptionSize: 'text-xs',
  // 按钮区域上边距
  buttonMarginTop: 'mt-3',
  // 按钮区域上内边距
  buttonPaddingTop: 'pt-3',
  // 按钮间距
  buttonGap: 'gap-1.5',
}
---

<div
  id={entry.id}
  class:list={[
    'flex scroll-mt-20 flex-row items-stretch overflow-hidden transition-all duration-300 ease-in-out',
    'hover:scale-[1.01] hover:shadow-lg',
    CARD_CONFIG.rounded,
  ]}
>
  <div
    class:list={[
      'shrink-0 self-stretch overflow-hidden',
      CARD_CONFIG.imageWidth,
    ]}
  >
    <BannerImage
      src={entry.data.image ?? undefined}
      defaultSrc={SITE.defaultProjectBanner}
      alt={entry.data.name}
      width={1200}
      height={630}
      class="h-full w-full object-contain"
    />
  </div>
  <div class:list={['flex grow flex-col', CARD_CONFIG.contentPadding]}>
    <div class:list={['flex grow flex-col', CARD_CONFIG.contentGap]}>
      <div>
        <h3 class:list={['mb-1 font-bold', CARD_CONFIG.titleSize]}>
          {entry.data.name}
        </h3>
        <p
          class:list={[
            'text-muted-foreground mb-1.5',
            CARD_CONFIG.descriptionSize,
          ]}
        >
          {entry.data.description}
        </p>
        {
          entry.data.tags && (
            <div class="flex flex-wrap gap-1.5">
              {entry.data.tags.map((tag: string) => {
                const iconEntry = ICON_MAP[tag as keyof typeof ICON_MAP]
                const iconName =
                  typeof iconEntry === 'string' ? iconEntry : iconEntry?.icon
                const iconColor =
                  typeof iconEntry === 'object' && iconEntry
                    ? iconEntry.color
                    : undefined
                return (
                  <span class="text-muted-foreground bg-muted/30 flex items-center gap-1 rounded-sm px-1.5 py-0.5 text-xs">
                    <Icon
                      name={iconName || 'lucide:code'}
                      class="size-2"
                      style={iconColor ? `color: ${iconColor}` : undefined}
                    />
                    {tag}
                  </span>
                )
              })}
            </div>
          )
        }
      </div>
    </div>
    {
      (entry.data.sourceCodeLink ||
        entry.data.siteLink ||
        entry.data.relatedBlogsLink) && (
        <div
          class:list={[
            'flex flex-wrap border-t',
            CARD_CONFIG.buttonMarginTop,
            CARD_CONFIG.buttonPaddingTop,
            CARD_CONFIG.buttonGap,
          ]}
        >
          {entry.data.sourceCodeLink && (
            <AnimatedButton
              href={entry.data.sourceCodeLink}
              external
              variant="outline"
              size="sm"
              class="w-full flex-1 grow justify-center"
              icon="lucide:code"
              iconPosition="left"
            >
              Source Code
            </AnimatedButton>
          )}
          {entry.data.relatedBlogsLink && (
            <AnimatedButton
              href={entry.data.relatedBlogsLink}
              variant="outline"
              size="sm"
              class="bg-accent hover:bg-accent/80 hover:text-background text-background dark:hover:bg-accent/80 w-full flex-1 grow justify-center"
              class="w-full flex-1 grow justify-center"
              icon="lucide:book-open"
              iconPosition="left"
            >
              Related Blogs
            </AnimatedButton>
          )}
          {entry.data.siteLink && (
            <AnimatedButton
              href={entry.data.siteLink}
              external
              variant="default"
              size="sm"
              class="w-full flex-1 grow justify-center"
              icon="lucide:arrow-right"
              iconPosition="right"
            >
              Visit Site
            </AnimatedButton>
          )}
        </div>
      )
    }
  </div>
</div>
