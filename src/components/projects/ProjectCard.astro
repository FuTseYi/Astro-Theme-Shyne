---
import AnimatedButton from '@/components/base/AnimatedButton.astro'
import BannerImage from '@/components/base/BannerImage.astro'
import { SITE } from '@/config'
import { Icon } from 'astro-icon/components'
import type { CollectionEntry } from 'astro:content'

interface Props {
  entry: CollectionEntry<'projects'>
}

const { entry } = Astro.props

// 格式化日期函数
const formatDate = (date: Date | null | undefined): string => {
  if (!date) return ''
  return new Intl.DateTimeFormat('en-US', {
    year: 'numeric',
    month: 'short',
  }).format(date)
}

const getDateRange = () => {
  const start = formatDate(entry.data.startDate)
  if (!start) return ''

  const end = formatDate(entry.data.endDate)
  if (end) {
    return `${start} - ${end}`
  }

  // 如果没有 endDate，显示 Present
  return `${start} - Present`
}

const dateRange = getDateRange()

// 卡片尺寸配置 - 可自定义修改
const CARD_CONFIG = {
  // 卡片圆角
  rounded: 'rounded-lg',
  // 图片区域宽度（所有屏幕尺寸统一显示在左侧）
  imageWidth: 'max-w-[100px] sm:max-w-[140px]', // 移动端 100px，桌面端 140px
  // 内容区域内边距
  contentPadding: 'p-3',
  // 内容间距
  contentGap: 'gap-3',
  // 标题字体大小
  titleSize: 'text-lg',
  // 描述字体大小
  descriptionSize: 'text-xs',
  // 按钮区域上边距
  buttonMarginTop: 'mt-3',
  // 按钮区域上内边距
  buttonPaddingTop: 'pt-3',
  // 按钮间距
  buttonGap: 'gap-1.5',
}
---

<div
  id={entry.id}
  class:list={[
    'flex scroll-mt-20 flex-row items-stretch overflow-hidden transition-all duration-300 ease-in-out',
    'hover:scale-[1.01] hover:shadow-lg',
    CARD_CONFIG.rounded,
  ]}
>
  <div
    class:list={[
      'shrink-0 self-stretch overflow-hidden',
      CARD_CONFIG.imageWidth,
    ]}
  >
    <BannerImage
      src={entry.data.image ?? undefined}
      defaultSrc={SITE.defaultProjectBanner}
      alt={entry.data.name}
      width={1200}
      height={630}
      class="h-full w-full object-contain"
    />
  </div>
  <div class:list={['flex grow flex-col', CARD_CONFIG.contentPadding]}>
    <div class:list={['flex grow flex-col', CARD_CONFIG.contentGap]}>
      <div>
        <h3 class:list={['mb-1 font-bold', CARD_CONFIG.titleSize]}>
          {entry.data.name}
        </h3>
        {
          dateRange && (
            <p class="text-muted-foreground mb-1.5 text-xs font-semibold">
              {dateRange}
            </p>
          )
        }
        <p
          class:list={[
            'text-muted-foreground mb-1.5',
            CARD_CONFIG.descriptionSize,
          ]}
        >
          {entry.data.description}
        </p>
        {
          entry.data.tags && entry.data.tags.length > 0 && (
            <div class="flex flex-wrap gap-2">
              {entry.data.tags.map((tag: { icon?: string; label: string }) => (
                <span class="bg-muted/90 text-muted-foreground/80 inline-flex items-center gap-1.5 rounded-full px-2 py-0.5 text-xs">
                  {tag.icon && <Icon name={tag.icon} class="size-2.5" />}
                  {tag.label}
                </span>
              ))}
            </div>
          )
        }
      </div>
    </div>
    {
      (entry.data.sourceCodeLink ||
        entry.data.siteLink ||
        entry.data.relatedBlogsLink) && (
        <div
          class:list={[
            'flex flex-wrap border-t',
            CARD_CONFIG.buttonMarginTop,
            CARD_CONFIG.buttonPaddingTop,
            CARD_CONFIG.buttonGap,
          ]}
        >
          {entry.data.sourceCodeLink && (
            <AnimatedButton
              href={entry.data.sourceCodeLink}
              external
              variant="outline"
              size="sm"
              class="w-full flex-1 grow justify-center"
              icon="lucide:code"
              iconPosition="left"
            >
              Source Code
            </AnimatedButton>
          )}
          {entry.data.relatedBlogsLink && (
            <AnimatedButton
              href={entry.data.relatedBlogsLink}
              variant="outline"
              size="sm"
              class="bg-accent hover:bg-accent/80 hover:text-background text-background dark:hover:bg-accent/80 w-full flex-1 grow justify-center"
              class="w-full flex-1 grow justify-center"
              icon="lucide:book-open"
              iconPosition="left"
            >
              Related Blogs
            </AnimatedButton>
          )}
          {entry.data.siteLink && (
            <AnimatedButton
              href={entry.data.siteLink}
              external
              variant="default"
              size="sm"
              class="w-full flex-1 grow justify-center"
              icon="lucide:arrow-right"
              iconPosition="right"
            >
              Visit Site
            </AnimatedButton>
          )}
        </div>
      )
    }
  </div>
</div>
